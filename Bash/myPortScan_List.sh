#!/bin/bash
# # # Port Discovery # # #
# nmap TCP ALL
# nmap UDP top 500
# serivce scan all ports
# list TCP, UDP, and ALL ports

# If ran with Sudo
if [ "$EUID" -ne 0 ]
   then echo "$(tput setaf 3)Please run as root"
   exit
fi

# If arg != 1 Print Usage
if [ -z "$1" ]
   then
   echo "$(tput setaf 3)Usage: sudo bash myRecon.sh x.x.x.x"
   exit
fi


# 1. Nmap TCP all ports
echo -e "$(tput setaf 5)\n\n[+](1/3) nmap $1 -sT -p-"
echo "$(tput setaf 7)"
nmap $1 -sT -p- > temp1.txt
cat temp1.txt
echo $(awk {'print $1'} temp1.txt | grep -E '/tcp$' | grep -oE "[0-9]+") > temp_PORTS_TCP.txt

# 2. Nmap UDP top 500 ports
echo -e "$(tput setaf 5)\n\n[+](2/3) nmap $1 -sU --top-ports 500"
echo "$(tput setaf 7)"
nmap $1 -sU --top-ports 500 > temp2.txt
cat temp2.txt
echo $(awk {'print $1'} temp2.txt | grep -E '/udp$' | grep -oE "[0-9]+") > temp_PORTS_UDP.txt

# Replace space with comma
TCP=$(sed -e "s/ /,/g" < temp_PORTS_TCP.txt)
UDP=$(sed -e "s/ /,/g" < temp_PORTS_UDP.txt)

# Remove temp files
rm temp1.txt
rm temp2.txt
rm temp_PORTS_TCP.txt
rm temp_PORTS_UDP.txt

# Concat and do Service scan
COMMA=","
ALL="$TCP$COMMA$UDP"
echo ""
echo -e "$(tput setaf 5)\n\n[+](3/3) nmap -p $ALL -sV -vv --open --reason"
echo "$(tput setaf 2)"
nmap $1 -p $ALL -sV -vv --open --reason

# Output TCP, UDP
echo -e "$(tput setaf 4)\n\n[+] TCP Ports . . ."
echo $TCP
echo ""
echo -e "$(tput setaf 3)\n[+] UDP Ports . . ."
echo $UDP
echo ""
echo -e "$(tput setaf 47)\n[+] ALL Ports . . ."
echo $ALL
echo ""
