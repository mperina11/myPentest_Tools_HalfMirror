#include<stdio.h>
#include<string.h>
#include <sys/mman.h> // for mprotect

// http://shell-storm.org/shellcode/files/shellcode-827.php
unsigned char code[] = \
"\x31\xc0\xb0\x01\x31\xdb\xcd\x80";
//"\x31\xc0\xb0\x01\x31\xdb\xb3\x0a\xcd\x80";

main()
{

	// Original
//	printf("Shellcode Length:  %d\n", strlen(code));
//	int (*ret)() = (int(*)())code;
//	ret();


	// https://gist.github.com/securitytube/5318838
	printf("Shellcode length: %d\n", strlen(code));
	int r =  mprotect((void *)((int)code & ~4095),  4096, PROT_READ | PROT_WRITE|PROT_EXEC);
	printf("mprotect: %d\n",r);
	int (*ret)() = (int(*)())code;
	return ret();
}

	
